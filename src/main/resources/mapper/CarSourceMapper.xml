<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.tieshan.disintegrate.dao.CarSourceMapper">


    <insert id="insertBank" parameterType="com.tieshan.disintegrate.pojo.Bank">
        insert into ts_bank
        <trim prefix="(" suffixOverrides="," suffix=")">
            <if test="id != null and id != ''">
                id,
            </if>
            <if test="disintegratePlantId != null and disintegratePlantId != ''">
                disintegrate_plant_id,
            </if>
            <if test="bankName != null and bankName != ''">
                bank_name,
            </if>
            <if test="bankBranch != null and bankBranch != ''">
                bank_branch,
            </if>
            <if test="account != null and account !=''">
                account,
            </if>
            <if test="payee != null and payee != ''">
                payee,
            </if>
            <if test="createTime != null">
                create_time,
            </if>
            <if test="operatorId != null and operatorId != ''">
                operator_id,
            </if>
            <if test="operator != null and operator != ''">
                operator,
            </if>
            <if test="isDelete != null and isDelete != ''">
                is_delete
            </if>
        </trim>
        VALUES
        <trim prefix="(" suffixOverrides="," suffix=")">
            <if test="id != null and id != ''">
                #{id},
            </if>
            <if test="disintegratePlantId != null and disintegratePlantId != ''">
                #{disintegratePlantId},
            </if>
            <if test="bankName != null and bankName != ''">
                #{bankName},
            </if>
            <if test="bankBranch != null and bankBranch != ''">
                #{bankBranch},
            </if>
            <if test="account != null and account !=''">
                #{account},
            </if>
            <if test="payee != null and payee != ''">
                #{payee},
            </if>
            <if test="createTime != null">
                #{createTime},
            </if>
            <if test="operatorId != null and operatorId != ''">
                #{operatorId},
            </if>
            <if test="operator != null and operator != ''">
                #{operator},
            </if>
            <if test="isDelete != null and isDelete != ''">
                #{isDelete}
            </if>
        </trim>
    </insert>

    <insert id="insertCarSource" parameterType="com.tieshan.disintegrate.pojo.CarSource">
        insert into ts_car_source
        <trim prefix="(" suffixOverrides="," suffix=")">
            <if test="id != null and id != ''">
                id,
            </if>
            <if test="disintegratePlantId != null and disintegratePlantId != ''">
                disintegrate_plant_id,
            </if>
            <if test="contacts != null and contacts != ''">
                contacts,
            </if>
            <if test="phone != null and phone != ''">
                phone,
            </if>
            <if test="count != null and count !=''">
                count,
            </if>
            <if test="carLocation != null and carLocation != ''">
                car_location,
            </if>
            <if test="userId != null and userId != ''">
                user_id,
            </if>
            <if test="bankId != null and bankId != ''">
                bank_id,
            </if>
            <if test="payType != null and payType != ''">
                pay_type,
            </if>
            <if test="payStatus != null and payStatus != ''">
                pay_Status,
            </if>
            <if test="payAmount != null and payAmount !=''">
                pay_amount,
            </if>
            <if test="createSource != null and createSource != ''">
                create_source,
            </if>
            <if test="createOperator != null and createOperator != ''">
                create_operator,
            </if>
            <if test="createOperatorId != null and createOperatorId != ''">
                create_operator_id,
            </if>
            <if test="createTime != null">
                create_time,
            </if>
            <if test="isDelete != null and isDelete != ''">
                is_delete
            </if>
        </trim>
        VALUES
        <trim prefix="(" suffixOverrides="," suffix=")">
            <if test="id != null and id != ''">
                #{id},
            </if>
            <if test="disintegratePlantId != null and disintegratePlantId != ''">
                #{disintegratePlantId},
            </if>
            <if test="contacts != null and contacts != ''">
                #{contacts},
            </if>
            <if test="phone != null and phone != ''">
                #{phone},
            </if>
            <if test="count != null and count !=''">
                #{count},
            </if>
            <if test="carLocation != null and carLocation != ''">
                #{carLocation},
            </if>
            <if test="userId != null and userId != ''">
                #{userId},
            </if>
            <if test="bankId != null and bankId != ''">
                #{bankId},
            </if>
            <if test="payType != null and payType != ''">
                #{payType},
            </if>
            <if test="payStatus != null and payStatus != ''">
                #{payStatus},
            </if>
            <if test="payAmount != null and payAmount !=''">
                #{payAmount},
            </if>
            <if test="createSource != null and createSource != ''">
                #{createSource},
            </if>
            <if test="createOperator != null and createOperator != ''">
                #{createOperator},
            </if>
            <if test="createOperatorId != null and createOperatorId != ''">
                #{createOperatorId},
            </if>
            <if test="createTime != null">
                #{createTime,jdbcType=TIMESTAMP},
            </if>
            <if test="isDelete != null and isDelete != ''">
                #{isDelete}
            </if>
        </trim>
    </insert>

    <select id="selectCarSourceList" resultType="java.util.Map">
        SELECT
            IFNULL(s.id, '') AS id,
            IFNULL(s.create_time, '') AS createTime,
	        IFNULL(s.contacts, '') AS contacts,
	        IFNULL(s.phone,'') AS phone,
	        IFNULL(s.car_location,'') AS carLocation,
			CONCAT(IFNULL(b.bank_name,''),',',IFNULL(b.bank_branch,''),',',IFNULL(b.account,'')) AS bankMessage
        FROM
	        ts_car_source AS s INNER JOIN ts_bank AS b INNER JOIN ts_car_info AS r
        ON
            s.id = r.car_source AND s.bank_id = b.id
        WHERE
            s.disintegrate_plant_id = #{disintegratePlantId} AND
            <if test="sourceType != null and sourceType != ''">
                s.source_type = #{sourceType}
            </if>
	        <include refid="queryMsg"></include>;
    </select>

    <select id="selectCarSourceListApp" resultType="java.util.Map">
        SELECT
        IFNULL(s.id, '') AS id,
        IFNULL(s.contacts, '') AS contacts,   /*联系人*/
        IFNULL(s.phone,'') AS phone,   /*联系人电话*/
        IFNULL(s.car_location,'') AS carLocation,    /*联系人地址*/
        IFNULL(s.count,'') AS count,     /*车辆台词*/
        IFNULL(b.bank_name,'') AS bankName,    /*银行名称*/
        IFNULL(b.account,'') AS account             /*银行账号*/
        FROM
        ts_car_source AS s INNER JOIN ts_bank AS b
        ON
        s.bank_id = b.id
        WHERE
        s.disintegrate_plant_id = #{disintegratePlantId} AND
        s.create_operator = #{loginName} AND
        s.create_operator_id = #{userId}
    </select>

    <sql id="queryMsg">
        <if test="findMsg != null and findMsg != ''">
            AND concat(s.contacts, s.phone, r.car_name, r.car_no, s.car_location)
            like concat("%",#{findMsg},"%")
        </if>
    </sql>


    <select id="selectProcessingTypeOrProceduresType" parameterType="java.lang.String" resultType="java.lang.String">
		SELECT
 			IFNULL(filed_name,'') AS filedName
		FROM
			ts_dictionary
		WHERE
			first_type = #{firstName};
	</select>

    <insert id="addCar" parameterType="com.tieshan.disintegrate.pojo.CarInfo">
        insert into ts_car_info
        <trim prefix="(" suffixOverrides="," suffix=")">
            <if test="id != null">
                id,
            </if>
            <if test="disintegratePlantId != null">
                disintegrate_plant_id,
            </if>
            <if test="carSource != null">
                car_source,
            </if>
            <if test="contacts != null and contacts != ''">
                contacts,
            </if>
            <if test="contactsPhone != null and contactsPhone !=''">
                contacts_phone,
            </if>
            <if test="carNo != null and carNo != ''">
                car_no,
            </if>
            <if test="processingType != null and processingType != ''">
                processing_type,
            </if>
            <if test="processingDate != null">
                processing_date,
            </if>
            <if test="drivLicense != null">
                driv_license,
            </if>
            <if test="registLicense != null">
                regist_license,
            </if>
            <if test="peopleLicense != null">
                people_license,
            </if>
            <if test="busineseLicense != null">
                businese_license,
            </if>
            <if test="breakLicense != null">
                break_license,
            </if>
            <if test="exceptionLicense != null">
                exception_license,
            </if>
            <if test="proceduresType != null and proceduresType != ''">
                procedures_type,
            </if>
            <if test="remarks != null and remarks !=''">
                remarks,
            </if>
            <if test="createTime != null">
                create_time,
            </if>
            <if test="operatorId != null">
                operator_id,
            </if>
            <if test="operator != null and operator != ''">
                operator,
            </if>
            <if test="carName != null and carName != ''">
                car_name,
            </if>
            <if test="isDelete != null">
                is_delete,
            </if>
            <if test="contactsAddress != null and contactsAddress != ''">
                contacts_address,
            </if>
            <if test="carCode != null and carCode != ''">
                car_code
            </if>
        </trim>
        VALUES
        <trim prefix="(" suffixOverrides="," suffix=")">
            <if test="id != null">
                #{id},
            </if>
            <if test="disintegratePlantId != null">
                #{disintegratePlantId},
            </if>
            <if test="carSource != null">
                #{carSource},
            </if>
            <if test="contacts != null and contacts != ''">
                #{contacts},
            </if>
            <if test="contactsPhone != null and contactsPhone !=''">
                #{contactsPhone},
            </if>
            <if test="carNo != null and carNo != ''">
                #{carNo},
            </if>
            <if test="processingType != null and processingType != ''">
                #{processingType},
            </if>
            <if test="processingDate != null">
                #{processingDate,jdbcType=TIMESTAMP},
            </if>
            <if test="drivLicense != null">
                #{drivLicense},
            </if>
            <if test="registLicense != null">
                #{registLicense},
            </if>
            <if test="peopleLicense != null">
                #{peopleLicense},
            </if>
            <if test="busineseLicense != null">
                #{busineseLicense},
            </if>
            <if test="breakLicense != null">
                #{breakLicense},
            </if>
            <if test="exceptionLicense != null">
                #{exceptionLicense},
            </if>
            <if test="proceduresType != null and proceduresType != ''">
                #{proceduresType},
            </if>
            <if test="remarks != null and remarks !=''">
                #{remarks},
            </if>
            <if test="createTime != null">
                #{createTime,jdbcType=TIMESTAMP},
            </if>
            <if test="operatorId != null">
                #{operatorId},
            </if>
            <if test="operator != null and operator != ''">
                #{operator},
            </if>
            <if test="carName != null and carName != ''">
                #{carName},
            </if>
            <if test="isDelete != null">
                #{isDelete},
            </if>
            <if test="contactsAddress != null and contactsAddress != ''">
                #{contactsAddress},
            </if>
            <if test="carCode != null and carCode != ''">
                #{carCode}
            </if>
        </trim>
    </insert>

    <insert id="insertCarEnter" parameterType="com.tieshan.disintegrate.pojo.CarEnter">
        insert into ts_car_enter
        <trim prefix="(" suffixOverrides="," suffix=")">
            <if test="id != null">
                id,
            </if>
            <if test="disintegratePlantId != null">
                disintegrate_plant_id,
            </if>
            <if test="carInfoId != null">
                car_info_id,
            </if>
            <if test="isApproach != null">
                is_approach,
            </if>
            <if test="approachTime != null">
                approach_time,
            </if>
            <if test="approachUserId != null">
                approach_user_id,
            </if>
            <if test="initialSurveyTime != null">
                initial_survey_time,
            </if>
            <if test="initialSurveyUserId != null">
                initial_survey_user_id,
            </if>
            <if test="isInitialSurvey != null">
                is_initial_survey,
            </if>
            <if test="printCodeTime != null">
                print_code_time,
            </if>
            <if test="printCodeUserId != null">
                print_code_user_id,
            </if>
            <if test="softPrint != null">
                soft_print,
            </if>
            <if test="pretreatmentTime != null">
                pretreatment_time,
            </if>
            <if test="pretreatmentUserId != null">
                pretreatment_user_id,
            </if>
            <if test="isPretreatment != null">
                is_pretreatment,
            </if>
            <if test="copyNumberTime != null">
                copy_number_time,
            </if>
            <if test="copyNumberUserId != null">
                copy_number_user_id,
            </if>
            <if test="isCopyNumber != null">
                is_copy_number,
            </if>
            <if test="dismantleUserId != null">
                dismantle_user_id,
            </if>
            <if test="dismantleTime != null">
                dismantle_time,
            </if>
            <if test="dismantleWay != null">
                dismantle_way,
            </if>
            <if test="carLocation != null and carLocation != ''">
                car_location,
            </if>
            <if test="locationId != null">
                location_id,
            </if>
            <if test="isOutput != null">
                is_output,
            </if>
            <if test="outputTime != null">
                output_time,
            </if>
            <if test="outputUser != null and outputUser != ''">
                output_user,
            </if>
            <if test="isDelete != null">
                is_delete,
            </if>
        </trim>
        VALUES
        <trim prefix="(" suffixOverrides="," suffix=")">
            <if test="id != null">
                #{id},
            </if>
            <if test="disintegratePlantId != null">
                #{disintegratePlantId},
            </if>
            <if test="carInfoId != null">
                #{carInfoId},
            </if>
            <if test="isApproach != null">
                #{isApproach},
            </if>
            <if test="approachTime != null">
                #{approachTime,jdbcType=TIMESTAMP},
            </if>
            <if test="approachUserId != null">
                #{approachUserId},
            </if>
            <if test="initialSurveyTime != null">
                #{initialSurveyTime,jdbcType=TIMESTAMP},
            </if>
            <if test="initialSurveyUserId != null">
                #{initialSurveyUserId},
            </if>
            <if test="isInitialSurvey != null">
                #{isInitialSurvey},
            </if>
            <if test="printCodeTime != null">
                #{printCodeTime,jdbcType=TIMESTAMP},
            </if>
            <if test="printCodeUserId != null">
                #{printCodeUserId},
            </if>
            <if test="softPrint != null">
                #{softPrint},
            </if>
            <if test="pretreatmentTime != null">
                #{pretreatmentTime,jdbcType=TIMESTAMP},
            </if>
            <if test="pretreatmentUserId != null">
                #{pretreatmentUserId},
            </if>
            <if test="isPretreatment != null">
                #{isPretreatment},
            </if>
            <if test="copyNumberTime != null">
                #{copyNumberTime,jdbcType=TIMESTAMP},
            </if>
            <if test="copyNumberUserId != null">
                #{copyNumberUserId},
            </if>
            <if test="isCopyNumber != null">
                #{isCopyNumber},
            </if>
            <if test="dismantleUserId != null">
                #{dismantleUserId},
            </if>
            <if test="dismantleTime != null">
                #{dismantleTime,jdbcType=TIMESTAMP},
            </if>
            <if test="dismantleWay != null">
                #{dismantleWay},
            </if>
            <if test="carLocation != null and carLocation != ''">
                #{carLocation}
            </if>
            <if test="locationId != null">
                #{locationId},
            </if>
            <if test="isOutput != null">
                #{isOutput},
            </if>
            <if test="outputTime != null">
                #{outputTime,jdbcType=TIMESTAMP},
            </if>
            <if test="outputUser != null and outputUser != ''">
                #{outputUser},
            </if>
            <if test="isDelete != null">
                #{isDelete}
            </if>
        </trim>
    </insert>

    <select id="selectCarSource" parameterType="java.lang.Long" resultType="com.tieshan.disintegrate.pojo.CarSource">
        SELECT
            IFNULL(id,'') AS id,
	        IFNULL(create_time,'') AS createTime,
	        IFNULL(contacts,'') AS contacts,
	        IFNULL(phone,'') AS phone,
            IFNULL(count,'') AS count,
	        IFNULL(car_location,'') AS carLocation
        FROM
	        ts_car_source
        WHERE
	        id = #{id} AND disintegrate_plant_id = #{disintegratePlantId};
    </select>

    <select id="selectCarInfoList" parameterType="java.lang.Long" resultType="java.util.Map">
        SELECT
	        IFNULL( id, '' ) AS id,
	        IFNULL( car_source, '' ) AS carSource,
	        IFNULL( contacts, '' ) AS contacts,
	        IFNULL( contacts_phone, '' ) AS contactsPhone,
	        IFNULL( car_no, '' ) AS carNo,
	        IFNULL( car_name, '' ) AS carName,
	        IFNULL( contacts_address, '' ) AS contactsAddress,
	        IFNULL( processing_type, '' ) AS processingType,
	        IFNULL( processing_date, '' ) AS processingDate,
	        IFNULL( driv_license, '' ) AS drivLicense,
	        IFNULL( regist_license, '' ) AS registLicense,
	        IFNULL( people_license, '' ) AS peopleLicense,
	        IFNULL( businese_license, '' ) AS busineseLicense,
	        IFNULL( break_license, '' ) AS breakLicense,
	        IFNULL( exception_license, '' ) AS exceptionLicense,
	        IFNULL( procedures_type, '' ) AS proceduresType,
	        IFNULL( remarks, '' ) AS remarks
        FROM
	        ts_car_info
        WHERE
	        car_source = #{carSource}
	        AND disintegrate_plant_id = #{disintegratePlantId};
    </select>

    <select id="selectCarInfoById" parameterType="java.lang.Long" resultType="com.tieshan.disintegrate.pojo.CarInfo">
        SELECT
	        IFNULL( id, '' ) AS id,
	        IFNULL( contacts, '' ) AS contacts,
	        IFNULL( contacts_phone, '' ) AS contactsPhone,
	        IFNULL( car_no, '' ) AS carNo,
	        IFNULL( car_name, '' ) AS carName,
	        IFNULL( contacts_address, '' ) AS contactsAddress,
	        IFNULL( processing_type, '' ) AS processingType,
	        IFNULL( processing_date, '' ) AS processingDate,
	        IFNULL( driv_license, '' ) AS drivLicense,
	        IFNULL( regist_license, '' ) AS registLicense,
	        IFNULL( businese_license, '' ) AS busineseLicense,
	        IFNULL( people_license, '' ) AS peopleLicense,
	        IFNULL( break_license, '' ) AS breakLicense,
	        IFNULL( exception_license, '' ) AS exceptionLicense,
	        IFNULL( procedures_type, '' ) AS proceduresType,
	        IFNULL( remarks, '' ) AS remarks
        FROM
	        ts_car_info
        WHERE
	        id = #{id}
	        AND disintegrate_plant_id = #{disintegratePlantId};
    </select>

    <update id="editCar" parameterType="com.tieshan.disintegrate.pojo.CarInfo">
        UPDATE ts_car_info SET
                car_source = #{carSource},
                contacts = #{contacts},
                contacts_phone = #{contactsPhone},
                car_no = #{carNo},
                car_name = #{carName},
                contacts_address = #{contactsAddress},
                processing_type = #{processingType},
                driv_license = #{drivLicense},
                regist_license = #{registLicense},
                people_license = #{peopleLicense},
                businese_license = #{busineseLicense},
                break_license = #{breakLicense},
                exception_license = #{exceptionLicense},
                procedures_type = #{proceduresType},
                remarks = #{remarks},
                create_time = #{createTime}
        WHERE id = #{id};
    </update>

    <update id="editCarSource" parameterType="com.tieshan.disintegrate.pojo.CarSource">
        UPDATE ts_car_source
        <set>
            <if test="contacts != null and contacts != ''">
                contacts = #{contacts},
            </if>
            <if test="phone != null and phone != ''">
                phone = #{phone},
            </if>
            <if test="count != null">
                count = #{count},
            </if>
            <if test="carLocation != null and carLocation != ''">
                car_location = #{carLocation},
            </if>
            <if test="userId != null">
                user_id = #{userId},
            </if>
            <if test="bankId != null">
                bank_id = #{bankId},
            </if>
            <if test="createTime != null">
                create_time = #{createTime}
            </if>
        </set>
        WHERE id = #{id};
    </update>

    <delete id="deleteCarInfoById" parameterType="java.lang.Long">
        DELETE FROM ts_car_info WHERE id =#{id} AND disintegrate_plant_id = #{disintegratePlantId};
    </delete>

    <select id="selectCarSourceById" parameterType="java.lang.Long" resultType="com.tieshan.disintegrate.pojo.CarSource">
        SELECT
	        IFNULL( id, '' ) AS id,
	        IFNULL( contacts, '' ) AS contacts,
	        IFNULL( count,'') AS count,
	        IFNULL( phone, '' ) AS phone,
	        IFNULL( user_id, '' ) AS userId,
	        IFNULL( bank_id, '' ) AS bankId,
	        IFNULL( car_location, '' ) AS carLocation
        FROM
	        ts_car_source
        WHERE
	        id = #{id}
	        AND disintegrate_plant_id = #{disintegratePlantId};

    </select>

    <select id="selectBankById" parameterType="java.lang.Long" resultType="com.tieshan.disintegrate.pojo.Bank">
        SELECT
	        IFNULL( id, '' ) AS id,
	        IFNULL( bank_name, '' ) AS bankName,
	        IFNULL( bank_branch, '' ) AS BankBranch,
	        IFNULL( account, '' ) AS account,
	        IFNULL( payee, '' ) AS payee,
	        IFNULL( create_time, '' ) AS createTime
        FROM
	        ts_bank
        WHERE
	        id = #{bankId};
    </select>

    <update id="updateBank" parameterType="com.tieshan.disintegrate.pojo.Bank">
        UPDATE ts_bank
        <set>
            <if test="bankName != null and bankName != ''">
                bank_name = #{bankName},
            </if>
            <if test="bankBranch != null and bankBranch != ''">
                bank_branch = #{bankBranch},
            </if>
            <if test="account != null and account != ''">
                account = #{account},
            </if>
            <if test="payee != null and payee != ''">
                payee = #{payee},
            </if>
            <if test="createTime != null">
                create_time = #{createTime}
            </if>
        </set>
        WHERE id = #{id};
    </update>

    <select id="selectCarInfoListByIds" resultType="java.util.Map">
        SELECT
        	IFNULL(i.id,'') AS id,
        	IFNULL(i.car_code,'') AS carCode,
        	IFNULL(i.car_no,'') AS carNo,
        	IFNULL(d.vin,'') AS vin,
        	IFNULL(e.approach_time,'') AS approachTime,
        	IFNULL(p.is_verify,'') AS isVerify
        FROM
        	ts_car_info AS i
        	INNER JOIN ts_car_processing AS p ON i.id = p.car_info_id
        	INNER JOIN ts_car_identity AS d ON i.id = d.car_info_id
        	INNER JOIN ts_car_enter AS e ON i.id = e.car_info_id
        WHERE i.disintegrate_plant_id = #{disintegratePlantId}
        	AND i.car_source = #{id}
        	AND e.is_approach = 2;
    </select>

    <delete id="deleteCarSourceById" parameterType="java.lang.Long">
        DELETE FROM ts_car_source WHERE id =#{id} AND disintegrate_plant_id = #{disintegratePlantId};
    </delete>
</mapper>