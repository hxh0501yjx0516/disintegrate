<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.tieshan.disintegrate.dao.CarSourceMapper">


    <insert id="insertBank" parameterType="com.tieshan.disintegrate.pojo.Bank">
        insert into ts_bank
        <trim prefix="(" suffixOverrides="," suffix=")">
            <if test="id != null and id != ''">
                id,
            </if>
            <if test="disintegratePlantId != null and disintegratePlantId != ''">
                disintegrate_plant_id,
            </if>
            <if test="bankName != null and bankName != ''">
                bank_name,
            </if>
            <if test="bankBranch != null and bankBranch != ''">
                bank_branch,
            </if>
            <if test="account != null and account !=''">
                account,
            </if>
            <if test="payee != null and payee != ''">
                payee,
            </if>
            <if test="createTime != null">
                create_time,
            </if>
            <if test="operatorId != null and operatorId != ''">
                operator_id,
            </if>
            <if test="operator != null and operator != ''">
                operator,
            </if>
            <if test="isDelete != null and isDelete != ''">
                is_delete
            </if>
        </trim>
        VALUES
        <trim prefix="(" suffixOverrides="," suffix=")">
            <if test="id != null and id != ''">
                #{id},
            </if>
            <if test="disintegratePlantId != null and disintegratePlantId != ''">
                #{disintegratePlantId},
            </if>
            <if test="bankName != null and bankName != ''">
                #{bankName},
            </if>
            <if test="bankBranch != null and bankBranch != ''">
                #{bankBranch},
            </if>
            <if test="account != null and account !=''">
                #{account},
            </if>
            <if test="payee != null and payee != ''">
                #{payee},
            </if>
            <if test="createTime != null">
                #{createTime},
            </if>
            <if test="operatorId != null and operatorId != ''">
                #{operatorId},
            </if>
            <if test="operator != null and operator != ''">
                #{operator},
            </if>
            <if test="isDelete != null and isDelete != ''">
                #{isDelete}
            </if>
        </trim>
    </insert>

    <insert id="insertCarSource" parameterType="com.tieshan.disintegrate.pojo.CarSource">
        insert into ts_car_source
        <trim prefix="(" suffixOverrides="," suffix=")">
            <if test="id != null and id != ''">
                id,
            </if>
            <if test="disintegratePlantId != null and disintegratePlantId != ''">
                disintegrate_plant_id,
            </if>
            <if test="contacts != null and contacts != ''">
                contacts,
            </if>
            <if test="phone != null and phone != ''">
                phone,
            </if>
            <if test="count != null and count !=''">
                count,
            </if>
            <if test="carLocation != null and carLocation != ''">
                car_location,
            </if>
            <if test="userId != null and userId != ''">
                user_id,
            </if>
            <if test="bankId != null and bankId != ''">
                bank_id,
            </if>
            <if test="payType != null and payType != ''">
                pay_type,
            </if>
            <if test="payStatus != null and payStatus != ''">
                pay_Status,
            </if>
            <if test="payAmount != null and payAmount !=''">
                pay_amount,
            </if>
            <if test="createSource != null and createSource != ''">
                create_source,
            </if>
            <if test="createOperator != null and createOperator != ''">
                create_operator,
            </if>
            <if test="createOperatorId != null and createOperatorId != ''">
                create_operator_id,
            </if>
            <if test="createTime != null">
                create_time,
            </if>
            <if test="isDelete != null and isDelete != ''">
                is_delete
            </if>
        </trim>
        VALUES
        <trim prefix="(" suffixOverrides="," suffix=")">
            <if test="id != null and id != ''">
                #{id},
            </if>
            <if test="disintegratePlantId != null and disintegratePlantId != ''">
                #{disintegratePlantId},
            </if>
            <if test="contacts != null and contacts != ''">
                #{contacts},
            </if>
            <if test="phone != null and phone != ''">
                #{phone},
            </if>
            <if test="count != null and count !=''">
                #{count},
            </if>
            <if test="carLocation != null and carLocation != ''">
                #{carLocation},
            </if>
            <if test="userId != null and userId != ''">
                #{userId},
            </if>
            <if test="bankId != null and bankId != ''">
                #{bankId},
            </if>
            <if test="payType != null and payType != ''">
                #{payType},
            </if>
            <if test="payStatus != null and payStatus != ''">
                #{payStatus},
            </if>
            <if test="payAmount != null and payAmount !=''">
                #{payAmount},
            </if>
            <if test="createSource != null and createSource != ''">
                #{createSource},
            </if>
            <if test="createOperator != null and createOperator != ''">
                #{createOperator},
            </if>
            <if test="createOperatorId != null and createOperatorId != ''">
                #{createOperatorId},
            </if>
            <if test="createTime != null">
                #{createTime,jdbcType=TIMESTAMP},
            </if>
            <if test="isDelete != null and isDelete != ''">
                #{isDelete}
            </if>
        </trim>
    </insert>

    <select id="selectCarSourceList" resultType="java.util.Map">
        SELECT
            IFNULL(s.id, '') AS id,
            IFNULL(s.create_time, '') AS createTime,
	        IFNULL(s.contacts, '') AS contacts,
	        IFNULL(s.phone,'') AS phone,
	        IFNULL(s.car_location,'') AS carLocation,
			CONCAT(IFNULL(b.bank_name,''),',',IFNULL(b.bank_branch,''),',',IFNULL(b.account,'')) AS bankMessage
        FROM
            ts_car_source AS s
            LEFT JOIN ts_bank AS b ON s.bank_id = b.id
            LEFT JOIN ts_car_info AS i ON s.id = i.car_source
        WHERE
            s.disintegrate_plant_id = #{disintegratePlantId}
            <if test="sourceType != null and sourceType != ''">
                AND  s.source_type = #{sourceType}
            </if>
	        <include refid="queryMsg2"></include>
    </select>

    <select id="selectCarSourceListApp" resultType="java.util.Map">
        SELECT
        IFNULL(s.id, '') AS id,
        IFNULL(s.contacts, '') AS contacts,   /*联系人*/
        IFNULL(s.phone,'') AS phone,   /*联系人电话*/
        IFNULL(s.car_location,'') AS carLocation,    /*联系人地址*/
        IFNULL(s.count,'') AS count,     /*车辆台词*/
        IFNULL(b.bank_name,'') AS bankName,    /*银行名称*/
        IFNULL(b.account,'') AS account             /*银行账号*/
        FROM
        ts_car_source AS s
        LEFT JOIN ts_bank AS b ON s.bank_id = b.id
        LEFT JOIN ts_car_info AS i ON s.id = i.car_source
        WHERE
        s.disintegrate_plant_id = #{disintegratePlantId} AND
        s.create_operator = #{loginName} AND
        s.create_operator_id = #{userId}
        <include refid="queryMsg2"></include>
    </select>

    <!--<select id="selectCarInfoCountByCarSourceId" parameterType="java.lang.Long" resultType="java.lang.Integer">
        SELECT
        	count( i.id ) AS carInfoCountByCarSourceId
        FROM
        	ts_car_source AS s
        	LEFT JOIN ts_car_info AS i ON s.id = i.car_source
        WHERE
        	s.disintegrate_plant_id = #{disintegratePlantId}
        	AND s.create_operator = #{loginName} AND
            s.create_operator_id = #{userId}
    </select>-->

    <sql id="queryMsg2">
        <if test="findMsg != null and findMsg != ''">
            AND concat(s.contacts, s.phone, s.car_location)
            LIKE concat("%",#{findMsg},"%")
        </if>
    </sql>

    <sql id="queryMsg">
        <if test="findMsg != null and findMsg != ''">
            AND concat(s.contacts, s.phone, i.car_name, i.car_no, s.car_location)
            LIKE concat("%",#{findMsg},"%")
        </if>
    </sql>


    <select id="selectProcessingTypeOrProceduresType" parameterType="java.lang.String" resultType="java.lang.String">
		SELECT
 			IFNULL(filed_name,'') AS filedName
		FROM
			ts_dictionary
		WHERE
			first_type = #{firstName}
	</select>

    <insert id="addCar" parameterType="com.tieshan.disintegrate.pojo.CarInfo">
        INSERT INTO ts_car_info
        <trim prefix="(" suffixOverrides="," suffix=")">
            <if test="id != null">
                id,
            </if>
            <if test="disintegratePlantId != null">
                disintegrate_plant_id,
            </if>
            <if test="carSource != null">
                car_source,
            </if>
            <if test="contacts != null and contacts != ''">
                contacts,
            </if>
            <if test="contactsPhone != null and contactsPhone !=''">
                contacts_phone,
            </if>
            <if test="carNo != null and carNo != ''">
                car_no,
            </if>
            <if test="processingType != null and processingType != ''">
                processing_type,
            </if>
            <if test="processingDate != null">
                processing_date,
            </if>
            <if test="drivLicense != null">
                driv_license,
            </if>
            <if test="registLicense != null">
                regist_license,
            </if>
            <if test="peopleLicense != null">
                people_license,
            </if>
            <if test="busineseLicense != null">
                businese_license,
            </if>
            <if test="breakLicense != null">
                break_license,
            </if>
            <if test="exceptionLicense != null">
                exception_license,
            </if>
            <if test="proceduresType != null and proceduresType != ''">
                procedures_type,
            </if>
            <if test="remarks != null and remarks !=''">
                remarks,
            </if>
            <if test="createTime != null">
                create_time,
            </if>
            <if test="operatorId != null">
                operator_id,
            </if>
            <if test="operator != null and operator != ''">
                operator,
            </if>
            <if test="carName != null and carName != ''">
                car_name,
            </if>
            <if test="isDelete != null">
                is_delete,
            </if>
            <if test="contactsAddress != null and contactsAddress != ''">
                contacts_address,
            </if>
            <if test="carCode != null and carCode != ''">
                car_code,
            </if>
            <if test="codeFront != null and codeFront != ''">
                code_front,
            </if>
            <if test="codeIn != null and codeIn != ''">
                code_in,
            </if>
            <if test="codeAfter != null">
                code_after
            </if>
        </trim>
        VALUES
        <trim prefix="(" suffixOverrides="," suffix=")">
            <if test="id != null">
                #{id},
            </if>
            <if test="disintegratePlantId != null">
                #{disintegratePlantId},
            </if>
            <if test="carSource != null">
                #{carSource},
            </if>
            <if test="contacts != null and contacts != ''">
                #{contacts},
            </if>
            <if test="contactsPhone != null and contactsPhone !=''">
                #{contactsPhone},
            </if>
            <if test="carNo != null and carNo != ''">
                #{carNo},
            </if>
            <if test="processingType != null and processingType != ''">
                #{processingType},
            </if>
            <if test="processingDate != null">
                #{processingDate,jdbcType=TIMESTAMP},
            </if>
            <if test="drivLicense != null">
                #{drivLicense},
            </if>
            <if test="registLicense != null">
                #{registLicense},
            </if>
            <if test="peopleLicense != null">
                #{peopleLicense},
            </if>
            <if test="busineseLicense != null">
                #{busineseLicense},
            </if>
            <if test="breakLicense != null">
                #{breakLicense},
            </if>
            <if test="exceptionLicense != null">
                #{exceptionLicense},
            </if>
            <if test="proceduresType != null and proceduresType != ''">
                #{proceduresType},
            </if>
            <if test="remarks != null and remarks !=''">
                #{remarks},
            </if>
            <if test="createTime != null">
                #{createTime,jdbcType=TIMESTAMP},
            </if>
            <if test="operatorId != null">
                #{operatorId},
            </if>
            <if test="operator != null and operator != ''">
                #{operator},
            </if>
            <if test="carName != null and carName != ''">
                #{carName},
            </if>
            <if test="isDelete != null">
                #{isDelete},
            </if>
            <if test="contactsAddress != null and contactsAddress != ''">
                #{contactsAddress},
            </if>
            <if test="carCode != null and carCode != ''">
                #{carCode},
            </if>
            <if test="codeFront != null and codeFront != ''">
                #{codeFront},
            </if>
            <if test="codeIn != null and codeIn != ''">
                #{codeIn},
            </if>
            <if test="codeAfter != null">
                #{codeAfter}
            </if>
        </trim>
    </insert>

    <insert id="insertCarEnter" parameterType="com.tieshan.disintegrate.pojo.CarEnter">
        insert into ts_car_enter
        <trim prefix="(" suffixOverrides="," suffix=")">
            <if test="id != null">
                id,
            </if>
            <if test="disintegratePlantId != null">
                disintegrate_plant_id,
            </if>
            <if test="carInfoId != null">
                car_info_id,
            </if>
            <if test="isApproach != null">
                is_approach,
            </if>
            <if test="approachTime != null">
                approach_time,
            </if>
            <if test="approachUserId != null">
                approach_user_id,
            </if>
            <if test="initialSurveyTime != null">
                initial_survey_time,
            </if>
            <if test="initialSurveyUserId != null">
                initial_survey_user_id,
            </if>
            <if test="isInitialSurvey != null">
                is_initial_survey,
            </if>
            <if test="printCodeTime != null">
                print_code_time,
            </if>
            <if test="printCodeUserId != null">
                print_code_user_id,
            </if>
            <if test="softPrint != null">
                soft_print,
            </if>
            <if test="pretreatmentTime != null">
                pretreatment_time,
            </if>
            <if test="pretreatmentUserId != null">
                pretreatment_user_id,
            </if>
            <if test="isPretreatment != null">
                is_pretreatment,
            </if>
            <if test="copyNumberTime != null">
                copy_number_time,
            </if>
            <if test="copyNumberUserId != null">
                copy_number_user_id,
            </if>
            <if test="isCopyNumber != null">
                is_copy_number,
            </if>
            <if test="dismantleUserId != null">
                dismantle_user_id,
            </if>
            <if test="dismantleTime != null">
                dismantle_time,
            </if>
            <if test="dismantleWay != null">
                dismantle_way,
            </if>
            <if test="carLocation != null and carLocation != ''">
                car_location,
            </if>
            <if test="locationId != null">
                location_id,
            </if>
            <if test="isOutput != null">
                is_output,
            </if>
            <if test="outputTime != null">
                output_time,
            </if>
            <if test="outputUser != null and outputUser != ''">
                output_user,
            </if>
            <if test="isDelete != null">
                is_delete,
            </if>
        </trim>
        VALUES
        <trim prefix="(" suffixOverrides="," suffix=")">
            <if test="id != null">
                #{id},
            </if>
            <if test="disintegratePlantId != null">
                #{disintegratePlantId},
            </if>
            <if test="carInfoId != null">
                #{carInfoId},
            </if>
            <if test="isApproach != null">
                #{isApproach},
            </if>
            <if test="approachTime != null">
                #{approachTime,jdbcType=TIMESTAMP},
            </if>
            <if test="approachUserId != null">
                #{approachUserId},
            </if>
            <if test="initialSurveyTime != null">
                #{initialSurveyTime,jdbcType=TIMESTAMP},
            </if>
            <if test="initialSurveyUserId != null">
                #{initialSurveyUserId},
            </if>
            <if test="isInitialSurvey != null">
                #{isInitialSurvey},
            </if>
            <if test="printCodeTime != null">
                #{printCodeTime,jdbcType=TIMESTAMP},
            </if>
            <if test="printCodeUserId != null">
                #{printCodeUserId},
            </if>
            <if test="softPrint != null">
                #{softPrint},
            </if>
            <if test="pretreatmentTime != null">
                #{pretreatmentTime,jdbcType=TIMESTAMP},
            </if>
            <if test="pretreatmentUserId != null">
                #{pretreatmentUserId},
            </if>
            <if test="isPretreatment != null">
                #{isPretreatment},
            </if>
            <if test="copyNumberTime != null">
                #{copyNumberTime,jdbcType=TIMESTAMP},
            </if>
            <if test="copyNumberUserId != null">
                #{copyNumberUserId},
            </if>
            <if test="isCopyNumber != null">
                #{isCopyNumber},
            </if>
            <if test="dismantleUserId != null">
                #{dismantleUserId},
            </if>
            <if test="dismantleTime != null">
                #{dismantleTime,jdbcType=TIMESTAMP},
            </if>
            <if test="dismantleWay != null">
                #{dismantleWay},
            </if>
            <if test="carLocation != null and carLocation != ''">
                #{carLocation}
            </if>
            <if test="locationId != null">
                #{locationId},
            </if>
            <if test="isOutput != null">
                #{isOutput},
            </if>
            <if test="outputTime != null">
                #{outputTime,jdbcType=TIMESTAMP},
            </if>
            <if test="outputUser != null and outputUser != ''">
                #{outputUser},
            </if>
            <if test="isDelete != null">
                #{isDelete}
            </if>
        </trim>
    </insert>

    <select id="selectCarSource" parameterType="java.lang.Long" resultType="com.tieshan.disintegrate.pojo.CarSource">
        SELECT
            IFNULL(id,'') AS id,
	        IFNULL(create_time,'') AS createTime,
	        IFNULL(contacts,'') AS contacts,
	        IFNULL(phone,'') AS phone,
            IFNULL(count,'') AS count,
	        IFNULL(car_location,'') AS carLocation
        FROM
	        ts_car_source
        WHERE
	        id = #{id} AND disintegrate_plant_id = #{disintegratePlantId};
    </select>

    <select id="selectCarInfoList" parameterType="java.lang.Long" resultType="java.util.Map">
        SELECT
	        IFNULL( id, '' ) AS id,
	        IFNULL( car_source, '' ) AS carSource,
	        IFNULL( contacts, '' ) AS contacts,
	        IFNULL( contacts_phone, '' ) AS contactsPhone,
	        IFNULL( car_no, '' ) AS carNo,
	        IFNULL( car_name, '' ) AS carName,
	        IFNULL( contacts_address, '' ) AS contactsAddress,
	        IFNULL( processing_type, '' ) AS processingType,
	        IFNULL( processing_date, '' ) AS processingDate,
	        IFNULL( driv_license, '' ) AS drivLicense,
	        IFNULL( regist_license, '' ) AS registLicense,
	        IFNULL( people_license, '' ) AS peopleLicense,
	        IFNULL( businese_license, '' ) AS busineseLicense,
	        IFNULL( break_license, '' ) AS breakLicense,
	        IFNULL( exception_license, '' ) AS exceptionLicense,
	        IFNULL( procedures_type, '' ) AS proceduresType,
	        IFNULL( remarks, '' ) AS remarks
        FROM
	        ts_car_info
        WHERE
	        car_source = #{carSource}
	        AND disintegrate_plant_id = #{disintegratePlantId};
    </select>

    <select id="selectCarInfoById" parameterType="java.lang.Long" resultType="com.tieshan.disintegrate.pojo.CarInfo">
        SELECT
	        IFNULL( id, '' ) AS id,
	        IFNULL( contacts, '' ) AS contacts,
	        IFNULL( contacts_phone, '' ) AS contactsPhone,
	        IFNULL( car_no, '' ) AS carNo,
	        IFNULL( car_name, '' ) AS carName,
	        IFNULL( contacts_address, '' ) AS contactsAddress,
	        IFNULL( processing_type, '' ) AS processingType,
	        IFNULL( processing_date, '' ) AS processingDate,
	        IFNULL( driv_license, '' ) AS drivLicense,
	        IFNULL( regist_license, '' ) AS registLicense,
	        IFNULL( businese_license, '' ) AS busineseLicense,
	        IFNULL( people_license, '' ) AS peopleLicense,
	        IFNULL( break_license, '' ) AS breakLicense,
	        IFNULL( exception_license, '' ) AS exceptionLicense,
	        IFNULL( procedures_type, '' ) AS proceduresType,
	        IFNULL( remarks, '' ) AS remarks
        FROM
	        ts_car_info
        WHERE
	        id = #{id}
	        AND disintegrate_plant_id = #{disintegratePlantId};
    </select>

    <update id="editCar" parameterType="com.tieshan.disintegrate.pojo.CarInfo">
        UPDATE ts_car_info SET
                car_source = #{carSource},
                contacts = #{contacts},
                contacts_phone = #{contactsPhone},
                car_no = #{carNo},
                car_name = #{carName},
                contacts_address = #{contactsAddress},
                processing_type = #{processingType},
                driv_license = #{drivLicense},
                regist_license = #{registLicense},
                people_license = #{peopleLicense},
                businese_license = #{busineseLicense},
                break_license = #{breakLicense},
                exception_license = #{exceptionLicense},
                procedures_type = #{proceduresType},
                remarks = #{remarks},
                create_time = #{createTime}
        WHERE id = #{id};
    </update>

    <update id="editCarSource" parameterType="com.tieshan.disintegrate.pojo.CarSource">
        UPDATE ts_car_source
        <set>
            <if test="contacts != null and contacts != ''">
                contacts = #{contacts},
            </if>
            <if test="phone != null and phone != ''">
                phone = #{phone},
            </if>
            <if test="count != null">
                count = #{count},
            </if>
            <if test="carLocation != null and carLocation != ''">
                car_location = #{carLocation},
            </if>
            <if test="userId != null">
                user_id = #{userId},
            </if>
            <if test="bankId != null">
                bank_id = #{bankId},
            </if>
            <if test="createTime != null">
                create_time = #{createTime}
            </if>
        </set>
        WHERE id = #{id};
    </update>

    <delete id="deleteCarInfoById" parameterType="java.lang.Long">
        DELETE FROM ts_car_info WHERE id =#{id} AND disintegrate_plant_id = #{disintegratePlantId};
    </delete>

    <select id="selectCarSourceById" parameterType="java.lang.Long" resultType="com.tieshan.disintegrate.pojo.CarSource">
        SELECT
	        IFNULL( id, '' ) AS id,
	        IFNULL( contacts, '' ) AS contacts,
	        IFNULL( count,'') AS count,
	        IFNULL( phone, '' ) AS phone,
	        IFNULL( user_id, '' ) AS userId,
	        IFNULL( bank_id, '' ) AS bankId,
	        IFNULL( car_location, '' ) AS carLocation
        FROM
	        ts_car_source
        WHERE
	        id = #{id}
	        AND disintegrate_plant_id = #{disintegratePlantId};

    </select>

    <select id="selectBankById" parameterType="java.lang.Long" resultType="com.tieshan.disintegrate.pojo.Bank">
        SELECT
	        IFNULL( bank_name, '' ) AS bankName,
	        IFNULL( bank_branch, '' ) AS BankBranch,
	        IFNULL( account, '' ) AS account,
	        IFNULL( payee, '' ) AS payee,
	        IFNULL( create_time, '' ) AS createTime
        FROM
	        ts_bank
        WHERE
	        id = #{bankId};
    </select>

    <update id="updateBank" parameterType="com.tieshan.disintegrate.pojo.Bank">
        UPDATE ts_bank
        <set>
            <if test="bankName != null and bankName != ''">
                bank_name = #{bankName},
            </if>
            <if test="bankBranch != null and bankBranch != ''">
                bank_branch = #{bankBranch},
            </if>
            <if test="account != null and account != ''">
                account = #{account},
            </if>
            <if test="payee != null and payee != ''">
                payee = #{payee},
            </if>
            <if test="createTime != null">
                create_time = #{createTime}
            </if>
        </set>
        WHERE id = #{id};
    </update>

    <select id="selectCarInfoListApp" resultType="java.util.Map">
        SELECT
            IFNULL(i.id,'') AS id,
            IFNULL(i.car_code,'') AS carCode,
            IFNULL(i.car_no,'') AS carNo,
            IFNULL(d.vin,'') AS vin,
            IFNULL(e.approach_time,'') AS approachTime,
            IFNULL(e.is_approach,'') AS isApproach,
            IFNULL(e.is_initial_survey,'') AS isInitialSurvey,
            IFNULL(e.is_pretreatment,'') AS isPretreatment,
            IFNULL(e.is_copy_number,'') AS isCopyNumber,
            IFNULL(p.is_register,'') AS isRegister,
            IFNULL(p.is_query,'') AS isQuery,
            IFNULL(p.is_verify,'') AS isVerify,
            IFNULL(p.is_data_upload,'') AS isDataUpload,
            IFNULL(p.is_dismantle,'') AS isDismantle,
            IFNULL(p.is_pic_upload,'') AS isPicUpload,
            IFNULL(p.is_appoint_logout_time,'') AS isAppointLogoutTime,
            IFNULL(s.is_get_salvage,'') AS isGetSalvage,
            IFNULL(p.is_premium_completion,'') AS isPremiumCompletion
        FROM
        	ts_car_info AS i

            LEFT JOIN ts_car_identity AS d ON i.id = d.car_info_id
            LEFT JOIN ts_car_enter AS e ON i.id = e.car_info_id
            LEFT JOIN ts_car_processing AS p ON i.id = p.car_info_id
            LEFT JOIN ts_car_salvage AS s ON i.id = s.car_info_id
        WHERE i.disintegrate_plant_id = #{disintegratePlantId}
        	AND i.car_source = #{id}
            <if test="findMsg != null and findMsg != ''">
                AND CONCAT(i.car_code,i.car_no,i.car_name) LIKE CONCAT('%',#{findMsg},'%')
            </if>
            <if test='states == "1"'>
                AND e.is_approach = 1
            </if>
            <if test='states == "2"'>
                AND e.is_approach = 2
                AND p.is_verify = 1
            </if>
            <if test='states == "3"'>
                AND p.is_verify = 2
                AND p.is_appoint_logout_time = 1
            </if>
            <if test='states == "4"'>
                AND p.is_appoint_logout_time = 2
                AND s.is_get_salvage = 1
            </if>
            <if test='states == "5"'>
                AND s.is_get_salvage = 2
                AND p.is_premium_completion = 1
            </if>
            <if test='states == "6"'>
                AND s.is_get_salvage = 2
                AND p.is_premium_completion = 2
            </if>
            <if test='states == "7"'>
                AND e.is_approach = 2
                AND p.is_verify = 3
            </if>
    </select>

    <select id="selectCarInfoListByIsVerify" resultType="java.util.Map">
        SELECT
            IFNULL(i.id,'') AS id,
            IFNULL(i.car_code,'') AS carCode,
            IFNULL(i.car_no,'') AS carNo,
            IFNULL(d.vin,'') AS vin,
            IFNULL(e.approach_time,'') AS approachTime
        FROM
        	ts_car_info AS i
						Left JOIN ts_car_source AS o ON i.car_source = o.id
            LEFT JOIN ts_car_identity AS d ON i.id = d.car_info_id
            LEFT JOIN ts_car_enter AS e ON i.id = e.car_info_id
            LEFT JOIN ts_car_processing AS p ON i.id = p.car_info_id
        WHERE i.disintegrate_plant_id = #{disintegratePlantId}
				AND create_operator = #{loginName}  AND create_operator_id = #{userId}
				AND p.is_query = 2 AND p.is_verify = 2
        <if test="findMsg != null and findMsg != ''">
            AND CONCAT(i.car_no,i.car_name,i.car_code) LIKE CONCAT("%",#{findMsg},"%")
        </if>
    </select>

    <select id="selectCarInfoByCarNo" resultType="java.util.Map">
        SELECT IFNULL(e.id,'') AS id, IFNULL(e.car_info_id,'') AS carInfoId FROM ts_car_info AS i LEFT JOIN ts_car_enter AS e ON i.id = e.car_info_id WHERE car_no = #{carNo} AND i.disintegrate_plant_id = #{disintegratePlantId}
    </select>

    <insert id="insertCarSurveyPart">
        INSERT INTO ts_car_survey
        <trim prefix="(" suffixOverrides="," suffix=")">
            <if test="id != null">
                id,
            </if>
            <if test="disintegratePlantId != null">
                disintegrate_plant_id,
            </if>
            <if test="carInfoId != null">
                car_info_id,
            </if>
            <if test="createTime != null">
                create_time,
            </if>
            <if test="selfWeight != null">
                self_weight,
            </if>
            <if test="createOperator != null and createOperator != ''">
                create_operator,
            </if>
            <if test="createOperatorId != null">
                create_operator_id,
            </if>
            <if test="cardColor != null and cardColor != ''">
                card_color
            </if>
        </trim>
        VALUES
        <trim prefix="(" suffixOverrides="," suffix=")">
            <if test="id != null">
                #{id},
            </if>
            <if test="disintegratePlantId != null">
                #{disintegratePlantId},
            </if>
            <if test="carInfoId != null">
                #{carInfoId},
            </if>
            <if test="createTime != null">
                #{createTime,jdbcType=TIMESTAMP},
            </if>
            <if test="selfWeight != null">
                #{selfWeight},
            </if>
            <if test="createOperator != null and createOperator != ''">
                #{createOperator},
            </if>
            <if test="createOperatorId != null">
                #{createOperatorId},
            </if>
            <if test="cardColor != null and cardColor != ''">
                #{cardColor}
            </if>
        </trim>
    </insert>

    <insert id="insertCarPic">
        INSERT INTO ts_car_pic
        <trim prefix="(" suffixOverrides="," suffix=")">
            <if test="id != null">
                id,
            </if>
            <if test="disintegratePlantId != null">
                disintegrate_plant_id,
            </if>
            <if test="fileName != null and fileName != ''">
                file_name,
            </if>
            <if test="fileUrl != null and fileUrl != ''">
                file_url,
            </if>
            <if test="firstType != null and firstType != ''">
                first_type,
            </if>
            <if test="twoType != null and twoType != ''">
                two_type,
            </if>
            <if test="carInfoId != null">
                car_info_id,
            </if>
            <if test="operatorId != null">
                operator_id,
            </if>
            <if test="operator != null and operator != ''">
                operator,
            </if>
            <if test="createTime != null">
                create_time,
            </if>
            <if test="isDelete != null">
                is_delete,
            </if>
        </trim>
        VALUES
        <trim prefix="(" suffixOverrides="," suffix=")">
            <if test="id != null">
                #{id},
            </if>
            <if test="disintegratePlantId != null">
                #{disintegratePlantId},
            </if>
            <if test="fileName != null and fileName != ''">
                #{fileName},
            </if>
            <if test="fileUrl != null and fileUrl != ''">
                #{fileUrl},
            </if>
            <if test="firstType != null and firstType != ''">
                #{firstType},
            </if>
            <if test="twoType != null and twoType != ''">
                #{twoType},
            </if>
            <if test="carInfoId != null">
                #{carInfoId},
            </if>
            <if test="operatorId != null">
                #{operatorId},
            </if>
            <if test="operator != null and operator != ''">
                #{operator},
            </if>
            <if test="createTime != null">
                #{createTime,jdbcType=TIMESTAMP},
            </if>
            <if test="isDelete != null">
                #{isDelete},
            </if>
        </trim>
    </insert>

    <select id="selectCarInfoReason" resultType="java.util.Map">
        SELECT
        	i.id,
        	i.car_no,
        	i.car_code,
        	i.car_name,
        	p.verify_result,
        	p.verify_time
        FROM
        	ts_car_info i
        	LEFT JOIN ts_car_processing p ON i.id = p.car_info_id
        WHERE
        	i.id = #{id}
        	AND i.disintegrate_plant_id = #{disintegratePlantId}
        	AND p.is_verify = 3

    </select>

    <select id="selectCarInfoByIsInitialSurvey" parameterType="java.lang.Long" resultType="java.util.Map">
        SELECT
        	i.id AS id,
        	i.car_no AS carNo,
        	i.car_name AS carName,
        	i.car_code AS carCode,
        	e.approach_time AS approachTime
        FROM
        	ts_car_info i
        	LEFT JOIN ts_car_enter e ON i.id = e.car_info_id
        WHERE
        	i.disintegrate_plant_id = #{disintegratePlantId}
        	AND e.is_approach = 2
        	AND e.is_initial_survey = 1
        <if test="findMsg != null and findMsg != ''">
            AND CONCAT(i.car_no,i.car_name,i.car_code) LIKE CONCAT("%",#{findMsg},"%")
        </if>
    </select>

    <select id="selectCarInfoByIdAndCarEnter" resultType="java.util.Map">
        SELECT
        	i.id AS id,
        	i.car_no AS carNo,
        	i.car_name AS carName,
        	i.car_code AS carCode,
        	e.approach_time AS approachTime
        FROM
        	ts_car_info i
        	LEFT JOIN ts_car_enter e ON i.id = e.car_info_id
        WHERE
        	i.disintegrate_plant_id = #{disintegratePlantId}
        	AND i.id = #{id}
    </select>

    <select id="selectCarSurveyByCarInfoId" resultType="com.tieshan.disintegrate.pojo.CarSurvey">
        SELECT
        	IFNULL( id, '' ) AS id,
        	IFNULL( disintegrate_plant_id, '' ) AS disintegratePlantId,
        	IFNULL( car_info_id, '' ) AS carInfoId,
        	IFNULL( plate_count, '' ) AS plateCount,
        	IFNULL( car_degree, '' ) AS carDegree,
        	IFNULL( condition_pump_count, '' ) AS conditionPumpCount,
        	IFNULL( battery_count, '' ) AS batteryCount,
        	IFNULL( motor_count, '' ) AS motorCount,
        	IFNULL( door_count, '' ) AS doorCount,
        	IFNULL( alloy_rim_count, '' ) AS alloyRimCount,
        	IFNULL( cistern_count, '' ) AS cisternCount,
        	IFNULL( electrical_machinery_count, '' ) AS electricalMachineryCount,
        	IFNULL( tyre_count, '' ) AS tyreCount,
        	IFNULL( chair_count, '' ) AS chairCount,
        	IFNULL( conditioner_count, '' ) AS conditionerCount,
        	IFNULL( catalytic_converter_count, '' ) AS catalyticConverterCount,
        	IFNULL( remark, '' ) AS remark
        FROM
        	ts_car_survey
        WHERE
        	car_info_id = #{id}
        	AND disintegrate_plant_id = #{disintegratePlantId};
    </select>

    <update id="editCarSurvey" parameterType="com.tieshan.disintegrate.pojo.CarSurvey">
        UPDATE ts_car_survey SET
        	plate_count = #{plateCount},
        	car_degree = #{carDegree},
        	condition_pump_count = #{conditionPumpCount},
        	battery_count = #{batteryCount},
        	motor_count = #{motorCount},
        	door_count = #{doorCount},
        	alloy_rim_count = #{alloyRimCount},
        	cistern_count = #{cisternCount},
        	electrical_machinery_count = #{electricalMachineryCount},
        	tyre_count = #{tyreCount},
        	chair_count = #{chairCount},
        	conditioner_count = #{conditionerCount},
        	catalytic_converter_count = #{catalyticConverterCount},
        	remark = #{remark},
        	create_time = #{createTime},
        	create_operator = #{createOperator},
        	create_operator_id = #{createOperatorId}
        WHERE
        	id = #{id};
    </update>

    <update id="updateCarEnterIsApproach" parameterType="com.tieshan.disintegrate.pojo.CarEnter">
        UPDATE ts_car_enter SET
        	is_approach = #{isApproach},
        	approach_time = #{approachTime},
        	approach_user_id = #{approachUserId},
        	is_initial_survey = #{isInitialSurvey}
        WHERE
        	id = #{id}
        	AND disintegrate_plant_id = #{disintegratePlantId}
    </update>

    <update id="updateCarEnterIsInitialSurvey" parameterType="com.tieshan.disintegrate.pojo.CarEnter">
        UPDATE ts_car_enter SET
        	is_initial_survey = #{isInitialSurvey},
	        initial_survey_time = #{initialSurveyTime},
	        initial_survey_user_id = #{initialSurveyUserId},
	        is_pretreatment = #{isPretreatment}
        WHERE
        	car_info_id = #{carInfoId}
        	AND disintegrate_plant_id = #{disintegratePlantId}
    </update>

    <select id="selectCarInfoListByDisintegratePlantId" resultType="java.util.Map">
        SELECT
            IFNULL(i.id,'') AS id,
            IFNULL(i.car_no,'') AS carNo,
            IFNULL(i.car_name,'') AS carName,
            IFNULL(i.car_code,'') AS carCode,
            IFNULL(e.approach_time,'') AS approachTime
        FROM
        	ts_car_info AS i
        	LEFT JOIN ts_car_enter AS e ON i.id = e.car_info_id
        WHERE
        	i.disintegrate_plant_id = #{disintegratePlantId}
        	<if test="findMsg != null and findMsg != ''">
                AND CONCAT(i.car_no,i.car_name,i.car_code) LIKE CONCAT("%",#{findMsg},"%")
            </if>
    </select>

    <select id="selectLocationListByPid" resultType="java.util.Map">
        SELECT
        	IFNULL( id, '' ) AS id,
        	IFNULL( car_location, '' ) AS carLocation
        FROM
        	ts_car_location
        WHERE
        	disintegrate_plant_id = #{disintegratePlantId}
        AND
        	pid = #{pid}
    </select>

    <update id="editCarInfoLocation" parameterType="com.tieshan.disintegrate.pojo.CarInfo">
        UPDATE ts_car_info
        SET car_location_area = #{carLocationArea},
        car_location_row = #{carLocationRow},
        car_location_column = #{carLocationColumn},
        car_location_number = #{carLocationNumber}
        WHERE
	    id = #{id}
    </update>

    <select id="selectCarCode" resultType="java.util.Map">
        SELECT
            MAX( code_after ) AS codeAfterMax
        FROM
            ts_car_info
        WHERE
            code_front = #{codeFront}
            AND code_in = #{codeIn}
            AND disintegrate_plant_id = #{disintegratePlantId}
    </select>

    <select id="selectCarInfoCountByCarNo" resultType="java.lang.Integer">
        SELECT
        	COUNT(id)
        FROM
        	ts_car_enter
        WHERE
        	car_info_id = ( SELECT id FROM ts_car_info WHERE car_no = #{carNo} AND disintegrate_plant_id = #{disintegratePlantId})
        	AND is_approach = 2
    </select>

    <delete id="deleteCarSourceById" parameterType="java.lang.Long">
        DELETE FROM ts_car_source WHERE id =#{id} AND disintegrate_plant_id = #{disintegratePlantId};
    </delete>

</mapper>